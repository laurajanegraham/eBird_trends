---
title: "eBird Occupancy Model Testing"
author: "Laura Graham"
date: "July 21, 2016"
output: 
  pdf_document:
    number_sections: true
---
```{r setup, message=FALSE, include=FALSE}
library(R2jags)
load("locations_sml.rda")
load("locations_full.rda")
```

# Data preparation
Currently working with the data for hummingbirds from Colorado. The dataset has been generated in Python and I have filtered it such that only locations which have greater than 3 observations in at least one month are included. This reduces the number of locations from `r nrow(locations_full)` to `r nrow(locations_sml)`. 

The final data output from Python is a 4-dimensional array where the dimensions are: Year, Location, Species and Replicate. 

```{r load_data}
load("data/hummingbirds_colorado.rda")

# size of array
dim(wide_dat)
```

# Initial models
## Basic dynamic occupancy model (no covariates)

Firstly, we want to fit a model with no covariates and get some initial parameter estimates out.

```{r basic_model}
# Code modified from Kery and Schaub 2012
# Bundle data
dat <- list(y = wide_dat, nyear = dim(wide_dat)[1], nsite = dim(wide_dat)[2], nspecies = dim(wide_dat)[3], nrep = dim(wide_dat)[4])

# Initial values
zst <- apply(wide_dat, c(1, 2, 3), max)	# Observed occurrence as inits for z
inits <- function(){ list(z = zst)}
# Parameters monitored
params <- c("psi", "phi", "gamma", "p", "n.occ", "growthr", "turnover")

# MCMC settings
ni <- 2500
nt <- 4
nb <- 500
nc <- 3

# Call JAGS from R
strt <- Sys.time()
out <- jags.parallel(dat, inits, params, "code/dynocc.JAGS.R", n.chains = nc, n.thin = nt, n.iter = ni, n.burnin = nb)

save(out, file="basic_model.Rda")

print(Sys.time() - strt)
print(out, digits=3)
